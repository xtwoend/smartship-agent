<?php

namespace App\Mqtt\Pagerungan;

use Carbon\Carbon;
use Hyperf\Utils\Str;
use Hyperf\Utils\Codec\Json;

class Panasia
{
    protected string $message;

    public function __construct(string $message) {
       
        $this->message = $message;
    }
    
    public function extract()
    {
        $data = Json::decode($this->message);
        $values = $data['panasia'];
        
        return [
            'cargo' => [
                'terminal_time' => $data['ts'] ?? Carbon::now()->format('Y-m-d H:i:s'),
                'cargo_tank1p_ullage' => $data[0],
                'cargo_tank1s_ullage' => $data[1],
                'cargo_tank2p_ullage' => $data[2],
                'cargo_tank2s_ullage' => $data[3],
                'cargo_tank3p_ullage' => $data[4],
                'cargo_tank3s_ullage' => $data[5],
                'cargo_tank4p_ullage' => $data[6],
                'cargo_tank4s_ullage' => $data[7],
                'cargo_tank5p_ullage' => $data[8],
                'cargo_tank5s_ullage' => $data[9],
                'slop_tank_p_ullage' => $data[10],
                'slop_tank_s_ullage' => $data[11],
                'water_ballast_tank1p_level' => $data[12],
                'water_ballast_tank1s_level' => $data[13],
                'water_ballast_tank2p_level' => $data[14],
                'water_ballast_tank2s_level' => $data[15],
                'water_ballast_tank3p_level' => $data[16],
                'water_ballast_tank3s_level' => $data[17],
                'water_ballast_tank4p_level' => $data[18],
                'water_ballast_tank4s_level' => $data[19],
                'water_ballast_tank5p_level' => $data[20],
                'water_ballast_tank5s_level' => $data[21],
                'water_ballast_tank6p_level' => $data[22],
                'water_ballast_tank6s_level' => $data[23],
                'fore_peak_tank_leve' => $data[24],
                'after_peak_tank_level' => $data[25],
                'no1_fo_tank_p_level' => $data[26],
                'no1_fo_tank_s_level' => $data[27],
                'no2_fo_tank_p_level' => $data[28],
                'no2_fo_tank_s_level' => $data[29],
                'no1_fo_service_tank_level' => $data[30],
                'no2_fo_service_tank_level' => $data[31],
                'fo_settling_tank_level' => $data[32],
                'do_storage_tank_p_level' => $data[33],
                'do_storage_tank_s_level' => $data[34],
                'no1_do_service_tank_level' => $data[35],
                'no2_do_service_tank_level' => $data[36],
                'do_setting_tank_level' => $data[37],
                'draft_sensor_level' => $data[38],
                'draft_mark_level' => $data[39],
                'draft_pp_level' => $data[40],
                'cargo_tank1p_upper_temp' => $data[41],
                'cargo_tank1p_middle_temp' => $data[42],
                'cargo_tank1p_bottom_temp' => $data[43],
                'cargo_tank1p_pressure' => $data[44],
                'cargo_tank1p_volume' => $data[45],
                'cargo_tank1s_upper_temp' => $data[46],
                'cargo_tank1s_middle_temp' => $data[47],
                'cargo_tank1s_bottom_temp' => $data[48],
                'cargo_tank1s_pressure' => $data[49],
                'cargo_tank1s_volume' => $data[50],
                'cargo_tank2p_upper_temp' => $data[51],
                'cargo_tank2p_middle_temp' => $data[52],
                'cargo_tank2p_bottom_temp' => $data[53],
                'cargo_tank2p_pressure' => $data[54],
                'cargo_tank2p_volume' => $data[55],
                'cargo_tank2s_upper_temp' => $data[56],
                'cargo_tank2s_middle_temp' => $data[57],
                'cargo_tank2s_bottom_temp' => $data[58],
                'cargo_tank2s_pressure' => $data[59],
                'cargo_tank2s_volume' => $data[60],
                'cargo_tank3p_upper_temp' => $data[61],
                'cargo_tank3p_middle_temp' => $data[62],
                'cargo_tank3p_bottom_temp' => $data[63],
                'cargo_tank3p_pressure' => $data[64],
                'cargo_tank3p_volume' => $data[65],
                'cargo_tank3s_upper_temp' => $data[66],
                'cargo_tank3s_middle_temp' => $data[67],
                'cargo_tank3s_bottom_temp' => $data[68],
                'cargo_tank3s_pressure' => $data[69],
                'cargo_tank3s_volume' => $data[70],
                'cargo_tank4p_upper_temp' => $data[71],
                'cargo_tank4p_middle_temp' => $data[72],
                'cargo_tank4p_bottom_temp' => $data[73],
                'cargo_tank4p_pressure' => $data[74],
                'cargo_tank4p_volume' => $data[75],
                'cargo_tank4s_upper_temp' => $data[76],
                'cargo_tank4s_middle_temp' => $data[77],
                'cargo_tank4s_bottom_temp' => $data[78],
                'cargo_tank4s_pressure' => $data[79],
                'cargo_tank4s_volume' => $data[80],
                'cargo_tank5p_upper_temp' => $data[81],
                'cargo_tank5p_middle_temp' => $data[82],
                'cargo_tank5p_bottom_temp' => $data[83],
                'cargo_tank5p_pressure' => $data[84],
                'cargo_tank5p_volume' => $data[85],
                'cargo_tank5s_upper_temp' => $data[86],
                'cargo_tank5s_middle_temp' => $data[87],
                'cargo_tank5s_bottom_temp' => $data[88],
                'cargo_tank5s_pressure' => $data[89],
                'cargo_tank5s_volume' => $data[90],
                'slop_tank_p_upper_temp' => $data[91],
                'slop_tank_p_middle_temp' => $data[92],
                'slop_tank_p_bottom_temp' => $data[93],
                'slop_tank_p_pressure' => $data[94],
                'slop_tank_p_volume' => $data[95],
                'slop_tank_s_upper_temp' => $data[96],
                'slop_tank_s_middle_temp' => $data[97],
                'slop_tank_s_bottom_temp' => $data[98],
                'slop_tank_s_pressure' => $data[99],
                'slop_tank_s_volume' => $data[100],
                'no1_fo_tank_p_volume' => $data[101],
                'no1_fo_tank_s_volume' => $data[102],
                'no2_fo_tank_p_volume' => $data[103],
                'no2_fo_tank_s_volume' => $data[104],
                'no1_fo_service_tank_volume' => $data[105],
                'no2_fo_service_tank_volume' => $data[106],
                'fo_settling_tank_volume' => $data[107],
                'do_storage_tank_p_volume' => $data[108],
                'do_storage_tank_s_volume' => $data[109],
                'no1_do_service_tank_volume' => $data[110],
                'no2_do_service_tank_volume' => $data[111],
                'do_setting_tank_volume' => $data[112],
            ]
        ];
    }

    function arrayToSnake() : array {
        $snake = [];
        foreach($this->mappArray as $in => $val) {
            if(is_null($val)) continue;
            $key = Str::snake(strtolower($val));
            $snake[$key] = $in;
        } 
        return $snake;
    }

    protected $mappArray = [
        'Cargo Tank 1P Ullage',
        'Cargo Tank 1S Ullage',
        'Cargo Tank 2P Ullage',
        'Cargo Tank 2S Ullage',
        'Cargo Tank 3P Ullage',
        'Cargo Tank 3S Ullage',
        'Cargo Tank 4P Ullage',
        'Cargo Tank 4S Ullage',
        'Cargo Tank 5P Ullage',
        'Cargo Tank 5S Ullage',
        'Slop Tank P Ullage',
        'Slop Tank S Ullage',
        'Water Ballast Tank 1P Level',
        'Water Ballast Tank 1S Level',
        'Water Ballast Tank 2P Level',
        'Water Ballast Tank 2S Level',
        'Water Ballast Tank 3P Level',
        'Water Ballast Tank 3S Level',
        'Water Ballast Tank 4P Level',
        'Water Ballast Tank 4S Level',
        'Water Ballast Tank 5P Level',
        'Water Ballast Tank 5S Level',
        'Water Ballast Tank 6P Level',
        'Water Ballast Tank 6S Level',
        'Fore Peak Tank Leve',
        'After Peak Tank Level',
        'No1 FO Tank P Level',
        'No1 FO Tank S Level',
        'No2 FO Tank P Level',
        'No2 FO Tank S Level',
        'No1 FO Service Tank  Level',
        'No2 FO Service Tank Level',
        'FO Settling Tank Level',
        'DO Storage Tank P Level',
        'DO Storage Tank S Level',
        'No1 DO Service Tank Level',
        'No2 DO Service Tank Level',
        'DO Setting Tank Level',
        'Draft Sensor Level',
        'Draft Mark Level',
        'Draft PP Level',
        'Cargo Tank 1P Upper Temp',
        'Cargo Tank 1P Middle Temp',
        'Cargo Tank 1P Bottom Temp',
        'Cargo Tank 1P Pressure',
        'Cargo Tank 1P Volume',
        'Cargo Tank 1S Upper Temp',
        'Cargo Tank 1S Middle Temp',
        'Cargo Tank 1S Bottom Temp',
        'Cargo Tank 1S Pressure',
        'Cargo Tank 1S Volume',
        'Cargo Tank 2P Upper Temp',
        'Cargo Tank 2P Middle Temp',
        'Cargo Tank 2P Bottom Temp',
        'Cargo Tank 2P Pressure',
        'Cargo Tank 2P Volume',
        'Cargo Tank 2S Upper Temp',
        'Cargo Tank 2S Middle Temp',
        'Cargo Tank 2S Bottom Temp',
        'Cargo Tank 2S Pressure',
        'Cargo Tank 2S Volume',
        'Cargo Tank 3P Upper Temp',
        'Cargo Tank 3P Middle Temp',
        'Cargo Tank 3P Bottom Temp',
        'Cargo Tank 3P Pressure',
        'Cargo Tank 3P Volume',
        'Cargo Tank 3S Upper Temp',
        'Cargo Tank 3S Middle Temp',
        'Cargo Tank 3S Bottom Temp',
        'Cargo Tank 3S Pressure',
        'Cargo Tank 3S Volume',
        'Cargo Tank 4P Upper Temp',
        'Cargo Tank 4P Middle Temp',
        'Cargo Tank 4P Bottom Temp',
        'Cargo Tank 4P Pressure',
        'Cargo Tank 4P Volume',
        'Cargo Tank 4S Upper Temp',
        'Cargo Tank 4S Middle Temp',
        'Cargo Tank 4S Bottom Temp',
        'Cargo Tank 4S Pressure',
        'Cargo Tank 4S Volume',
        'Cargo Tank 5P Upper Temp',
        'Cargo Tank 5P Middle Temp',
        'Cargo Tank 5P Bottom Temp',
        'Cargo Tank 5P Pressure',
        'Cargo Tank 5P Volume',
        'Cargo Tank 5S Upper Temp',
        'Cargo Tank 5S Middle Temp',
        'Cargo Tank 5S Bottom Temp',
        'Cargo Tank 5S Pressure',
        'Cargo Tank 5S Volume',
        'Slop Tank P Upper Temp',
        'Slop Tank P Middle Temp',
        'Slop Tank P Bottom Temp',
        'Slop Tank P Pressure',
        'Slop Tank P Volume',
        'Slop Tank S Upper Temp',
        'Slop Tank S Middle Temp',
        'Slop Tank S Bottom Temp',
        'Slop Tank S Pressure',
        'Slop Tank S Volume',
        'No1 FO Tank P Volume',
        'No1 FO Tank S Volume',
        'No2 FO Tank P Volume',
        'No2 FO Tank S Volume',
        'No1 FO Service Tank  Volume',
        'No2 FO Service Tank Volume',
        'FO Settling Tank Volume',
        'DO Storage Tank P Volume',
        'DO Storage Tank S Volume',
        'No1 DO Service Tank Volume',
        'No2 DO Service Tank Volume',
        'DO Setting Tank Volume',
    ];
}